{"config":{"lang":["en"],"prebuild_index":false,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"\u6b22\u8fce\u4f7f\u7528\u54b8\u9c7c\u6d3e SFPi \u6982\u8ff0 \u54b8\u9c7c\u6d3e\u662f\u4e00\u6b3e\u57fa\u4e8e Allwinner V3s \u5904\u7406\u5668\u7684\u5355\u677f\u8ba1\u7b97\u673a\uff08SBC\uff09\uff0c\u5f62\u72b6\u4e0e\u6811\u8393\u6d3e\u4e00\u81f4\uff0c \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u63a5\u53e3\u548c\u5916\u8bbe\uff0c\u975e\u5e38\u9002\u5408\u4e2d\u4f4e\u6027\u80fd\u4ea7\u54c1\u5f00\u53d1\u3002 \u7279\u6027 Cortex-A7 1.2GHz\uff08ARM v7-A\uff09\u5904\u7406\u5668 64 MiB DRAM 100 Mbps \u4ee5\u592a\u7f51 PoE\uff08IEEE 802.3at / PoE+\uff09 \u300112V DC\u3001Micro USB \u4e09\u79cd\u4f9b\u7535\u65b9\u5f0f \u9884\u7559\u786c\u4ef6\u770b\u95e8\u72d7\u82af\u7247\u710a\u76d8\uff08TPS3823-33DBVR\uff09 SD/MMC \u5361\uff0c\u9884\u7559 SPI Flash \u710a\u76d8\uff08SOIC-8 \u5c01\u88c5\uff09 \u5185\u7f6e USB TTL (CH330) \u6a21\u5757 \u53cc\u8def USB 2.0 \u63a5\u53e3 3.5mm \u97f3\u9891\u8f93\u51fa\u3001\u9ea6\u514b\u98ce\u8f93\u5165 \u652f\u6301 Wi-Fi\uff08802.11 bgn\uff09\u548c Bluetooth 4.0 IO\uff08GPIO/SPI/I2C/UART\uff09\u4e0e\u6811\u8393\u6d3e\u51e0\u4e4e\u517c\u5bb9\uff0c\u9002\u914d\u5e38\u89c1\u6811\u8393\u6d3e\u6269\u5c55\u677f \u9002\u914d\u5e38\u89c1\u6811\u8393\u6d3e\u5916\u58f3 Linux \u4e3b\u7ebf\u652f\u6301 \u5feb\u901f\u5f00\u59cb \u8d44\u6599\u4e0b\u8f7d \u539f\u7406\u56fe V3s \u6570\u636e\u624b\u518c \u8d2d\u4e70\u94fe\u63a5 \u6dd8\u5b9d","title":"\u5165\u95e8"},{"location":"#sfpi","text":"","title":"\u6b22\u8fce\u4f7f\u7528\u54b8\u9c7c\u6d3e SFPi"},{"location":"#_1","text":"\u54b8\u9c7c\u6d3e\u662f\u4e00\u6b3e\u57fa\u4e8e Allwinner V3s \u5904\u7406\u5668\u7684\u5355\u677f\u8ba1\u7b97\u673a\uff08SBC\uff09\uff0c\u5f62\u72b6\u4e0e\u6811\u8393\u6d3e\u4e00\u81f4\uff0c \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u63a5\u53e3\u548c\u5916\u8bbe\uff0c\u975e\u5e38\u9002\u5408\u4e2d\u4f4e\u6027\u80fd\u4ea7\u54c1\u5f00\u53d1\u3002","title":"\u6982\u8ff0"},{"location":"#_2","text":"Cortex-A7 1.2GHz\uff08ARM v7-A\uff09\u5904\u7406\u5668 64 MiB DRAM 100 Mbps \u4ee5\u592a\u7f51 PoE\uff08IEEE 802.3at / PoE+\uff09 \u300112V DC\u3001Micro USB \u4e09\u79cd\u4f9b\u7535\u65b9\u5f0f \u9884\u7559\u786c\u4ef6\u770b\u95e8\u72d7\u82af\u7247\u710a\u76d8\uff08TPS3823-33DBVR\uff09 SD/MMC \u5361\uff0c\u9884\u7559 SPI Flash \u710a\u76d8\uff08SOIC-8 \u5c01\u88c5\uff09 \u5185\u7f6e USB TTL (CH330) \u6a21\u5757 \u53cc\u8def USB 2.0 \u63a5\u53e3 3.5mm \u97f3\u9891\u8f93\u51fa\u3001\u9ea6\u514b\u98ce\u8f93\u5165 \u652f\u6301 Wi-Fi\uff08802.11 bgn\uff09\u548c Bluetooth 4.0 IO\uff08GPIO/SPI/I2C/UART\uff09\u4e0e\u6811\u8393\u6d3e\u51e0\u4e4e\u517c\u5bb9\uff0c\u9002\u914d\u5e38\u89c1\u6811\u8393\u6d3e\u6269\u5c55\u677f \u9002\u914d\u5e38\u89c1\u6811\u8393\u6d3e\u5916\u58f3 Linux \u4e3b\u7ebf\u652f\u6301","title":"\u7279\u6027"},{"location":"#_3","text":"","title":"\u5feb\u901f\u5f00\u59cb"},{"location":"#_4","text":"\u539f\u7406\u56fe V3s \u6570\u636e\u624b\u518c","title":"\u8d44\u6599\u4e0b\u8f7d"},{"location":"#_5","text":"\u6dd8\u5b9d","title":"\u8d2d\u4e70\u94fe\u63a5"},{"location":"peripherals/","text":"\u5916\u8bbe\u914d\u7f6e \u7b49\u5f85\u5b8c\u5584...","title":"\u5916\u8bbe"},{"location":"peripherals/#_1","text":"\u7b49\u5f85\u5b8c\u5584...","title":"\u5916\u8bbe\u914d\u7f6e"},{"location":"build/linux/","text":"Linux \u5185\u6838\u7f16\u8bd1 \u4e0b\u8f7d Linux \u6e90\u7801\u548c\u5e94\u7528 Patch \u6211\u4eec\u5728 sbc-fish/sfpi:/linux \u7ef4\u62a4\u4e86\u5bf9 Linux \u4e3b\u7ebf\u5185\u6838\u7684 Patch \u3002\u5b83\u63d0\u4f9b\u4e86\u54b8\u9c7c\u6d3e\u8bbe\u5907\u7684 DTS\u3001\u9ed8\u8ba4\u7684 .config \u548c\u5176\u5b83\u4e00\u4e9b\u5c0f\u7684\u66f4\u6539\u3002\u76ee\u524d\u5df2\u7ecf\u652f\u6301\u7684\u5185\u6838\u7248\u672c\u89c1\u4ee5\u4e0a\u94fe\u63a5\uff0c\u5176\u5b83\u5185\u6838\u7248\u672c\u53ef\u6839\u636e\u6700\u63a5\u8fd1\u7684\u5185\u6838\u7248\u672c\u7684 Patch \u8fdb\u884c\u66f4\u6539\u3002 \u4e0b\u8f7d Linux \u5185\u6838\u6e90\u7801\uff0c\u4ee5 4.19.1 \u4e3a\u4f8b\uff1a $ wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.19.1.tar.xz $ tar xvf linux-4.19.1.tar.xz $ cd linux-4.19.1 \u5e94\u7528\u6211\u4eec\u63d0\u4f9b\u7684 Patch \uff1a $ curl https://raw.githubusercontent.com/sbc-fish/sfpi/master/linux/4.19.1/sfpi-linux-4.19.1.patch | patch -p1 patching file arch/arm/boot/dts/Makefile patching file arch/arm/boot/dts/sun8i-v3s-saltedfishpi.dts patching file arch/arm/boot/dts/sun8i-v3s.dtsi patching file arch/arm/configs/saltedfishpi_defconfig patching file drivers/bluetooth/Kconfig patching file drivers/bluetooth/hci_h5.c \u83b7\u53d6\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe \u60a8\u5982\u679c\u5df2\u7ecf\u9605\u8bfb\u8fc7 [\u7f16\u8bd1\u548c\u5237\u5165 U-Boot]\uff08https://sbc-fish.github.io/sfpi/uboot/\uff09\u4e2d\u7684\u76f8\u5173\u90e8\u5206\uff0c\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u5c0f\u8282\u3002 \u60a8\u5982\u679c\u662f Archlinux \u7528\u6237\uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5 arm-none-eabi-gcc \uff1a $ sudo pacman -Sy arm-none-eabi-gcc \u60a8\u5982\u679c\u662f Debian \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf \uff1a $ sudo apt install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Ubuntu \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf $ sudo apt-get install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Fedora \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 arm-none-eabi-gcc-cs $ sudo dnf install arm-none-eabi-gcc-cs \u5bf9\u4e8e\u672a\u5217\u51fa\u7684 Linux \u53d1\u578b\u7248\uff0c\u60a8\u53ef\u4ee5\u641c\u7d22\u4e00\u4e0b\u5b83\u7684\u6e90\u6709\u6ca1\u6709\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Linaro GCC \u3002 \u7531\u4e8e\u5404\u53d1\u578b\u7248\u5b89\u88c5\u7684\u4ea4\u53c9\u7f16\u8bd1\u5668\u524d\u7f00\u4e0d\u540c\uff0c\u5982\u679c\u5b89\u88c5\u7684\u7f16\u8bd1\u5668\u662f arm-none-eabi-gcc \uff0c\u90a3\u4e48\u6211\u4eec\u4e4b\u540e\u7528\u5230\u7684 CROSS_COMPILE \u5c31\u662f arm-none-eabi- \uff0c\u5373\u53bb\u6389\u6700\u540e\u7684 gcc \u90e8\u5206\u3002\u5176\u5b83\u5e38\u89c1\u7684\u8fd8\u6709 arm-linux-gnueabihf- \u548c arm-linux-gnueabi \uff0c\u90fd\u53ef\u4ee5\u3002 \u751f\u6210\u5e76\u66f4\u6539 Linux .config \u91c7\u7528\u6211\u4eec\u63d0\u4f9b\u7684 .config \u5728\u521a\u624d\u5e94\u7528\u7684 Patch \u4e2d\uff0c\u5df2\u7ecf\u5305\u542b\u4e86\u4e00\u4e2a\u5df2\u7ecf\u6d4b\u8bd5\u7684 .config \uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- saltedfishpi_defconfig \u5982\u679c\u60f3\u8981\u81ea\u5df1\u8c03\u6574\u914d\u7f6e\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- menuconfig \u7f16\u8bd1 Linux \u5185\u6838 \u7528\u5982\u4e0b\u547d\u4ee4\u7f16\u8bd1 Linux \u5185\u6838\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- -j4 \u7f16\u8bd1 Linux \u7684\u65f6\u957f\u53d6\u51b3\u4e8e\u60a8\u7684\u673a\u5668\u7684\u786c\u4ef6\u8bbe\u65bd\uff0c\u5e76\u6839\u636e CPU \u7ebf\u7a0b\u6570\u8c03\u6574 -j \u53c2\u6570\u3002\u4e0d\u59a8\u5728\u7b49\u5f85 Linux \u7f16\u8bd1\u7684\u65f6\u5019\u70b9\u676f\u5496\u5561\u3002 \u7f16\u8bd1\u597d\u540e\uff0c\u5e94\u8be5\u53ef\u4ee5\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684 arch/arm/boot/zImage \u548c arch/arm/boot/dts/sun8i-v3s-saltedfishpi.dtb \u6587\u4ef6\u3002 \u5199\u5165 TF \u5361 \u5c06\u7f16\u8bd1\u5f97\u5230\u7684 arch/arm/boot/zImage \u548c arch/arm/boot/dts/sun8i-v3s-saltedfishpi.dtb \u6587\u4ef6\u62f7\u8d1d\u5165 TF \u5361\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u5efa\u8bae\u5199\u5165 FAT \u6216\u8005 EXT \u6587\u4ef6\u7cfb\u7edf\u3002 \u51c6\u5907 rootfs \u4ec5\u6709\u5185\u6838\u5e76\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e00\u4e2a rootfs \u3002\u5e38\u89c1\u7684\u529e\u6cd5\u6709 buildroot \u548c\u76f4\u63a5\u91c7\u7528\u5df2\u6709\u7684\u53d1\u578b\u7248\u7684\u955c\u50cf\uff0c\u8fd9\u91cc\u4ee5 ArchLinuxARM \u4e3a\u4f8b\uff0c\u5047\u8bbe\u6211\u4eec\u9884\u671f\u7684 rootfs \u5206\u533a\u5df2\u7ecf\u6302\u8f7d\u5230\u4e86 mnt \u5904\uff1a $ wget http://os.archlinuxarm.org/os/ArchLinuxARM-armv7-latest.tar.gz $ bsdtar -xpf ArchLinuxARM-armv7-latest.tar.gz -C mnt \u60a8\u5982\u679c\u91c7\u7528\u7684\u662f macOS \u7cfb\u7edf\u5e76\u4e14\u65e0\u6cd5\u5199\u5165 EXT4 \u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5148\u627e\u5230\u4e00\u53f0 Linux \u673a\u5668\uff0c\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\uff1a $ dd if=/dev/zero of=archlinuxarm.img bs=1M count=1024 $ mkfs.ext4 archlinuxarm.img $ sudo mount -o loop archlinuxarm.img mnt $ wget http://os.archlinuxarm.org/os/ArchLinuxARM-armv7-latest.tar.gz $ bsdtar -xpf ArchLinuxARM-armv7-latest.tar.gz -C mnt $ sudo umount mnt \u5c06\u5f97\u5230\u7684 archlinuxarm.img \u590d\u5236\u5230 macOS \u7cfb\u7edf\u4e0b\uff0c\u518d\u5199\u5165\uff1a $ sudo dd if=archlinuxarm.img of=/dev/[disk] bs=65535 \u6b64\u5904\u7684 [disk] \u53ef\u4ee5\u7528 diskutil list \u627e\u5230\u76f8\u5e94\u7684\u5206\u533a\u3002\u4e3a\u4e86\u6027\u80fd\u66f4\u597d\uff0c\u53ef\u4ee5\u5728\u8bbe\u5907\u540d\u79f0\u524d\u6dfb\u52a0\u4e00\u4e2a r \uff0c\u5982 /dev/rdisk4s2 \u3002 \u5982\u679c\u60a8\u5728 macOS \u4e0a\u5b89\u88c5\u4e86 e2fsprogs \uff08 brew install e2fsprogs \uff09\uff0c\u53ef\u4ee5\u628a\u6587\u4ef6\u7cfb\u7edf\u6269\u5927\u6210\u5206\u533a\u7684\u5b8c\u6574\u5927\u5c0f\uff1a $ sudo /usr/local/opt/e2fsprogs/sbin/resize2fs -p /dev/[disk] \u8fd9\u91cc\u7684 [disk] \u610f\u4e49\u540c\u4e0a\u3002 \u914d\u7f6e U-Boot \u542f\u52a8\u9009\u9879 \u5728 \u7f16\u8bd1\u548c\u5237\u5165 U-Boot \u4e2d\uff0c\u60a8\u5e94\u8be5\u5df2\u7ecf\u53ef\u4ee5\u8fdb\u5165\u5230 U-Boot \u7684\u754c\u9762\u4e86\u3002\u9996\u5148\u9700\u8981\u627e\u5230\u6211\u4eec\u521a\u624d\u6784\u5efa\u5f97\u5230\u7684\u5185\u6838\u548c .dtb \u6587\u4ef6\u3002\u67e5\u770b TF \u5361\u7684\u5206\u533a\u8868\uff1a => part list mmc 0 Partition Map for MMC device 0 -- Partition Type: DOS Part Start Sector Num Sectors UUID Type 1 8192 85045 68db6199-01 0c 2 94208 30453760 68db6199-02 83 => \u6b64\u5904\u53ef\u4ee5\u770b\u5230 TF \u5361\u4e0a\u7684\u5206\u533a\u60c5\u51b5\u3002\u8fd9\u91cc\u7684\u4f8b\u5b50\u662f\uff0c\u4e00\u4e2a FAT \u5206\u533a\u4fdd\u5b58\u5185\u6838\u548c .dtb \u6587\u4ef6\uff0c\u53e6\u4e00\u4e2a EXT4 \u5206\u533a\u5b58\u653e\u7740 rootfs \u3002\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u786e\u8ba4\u4e00\u4e0b\u5185\u6838\u5b58\u653e\u7684\u5730\u65b9\uff1a => fatls mmc 0:1 # \u6d4f\u89c8\u5206\u533a 1 \uff08FAT \u6587\u4ef6\u7cfb\u7edf\uff09\u4e0a\u7684\u6587\u4ef6 => ext4ls mmc 0:2 # \u6d4f\u89c8\u5206\u533a 2 \uff08EXT4 \u6587\u4ef6\u7cfb\u7edf\uff09\u4e0a\u7684\u6587\u4ef6 \u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6240\u9700\u7684\u6587\u4ef6 zImage \u548c sun8i-v3s-saltedfishpi.dtb \u653e\u5728\u4e86\u7b2c\u4e00\u4e2a\u5206\u533a\uff08FAT \u6587\u4ef6\u7cfb\u7edf\uff09\u4e2d\u3002\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u628a\u5185\u6838\u548c .dtb \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff1a => fatload mmc 0:1 0x41000000 zImage => fatload mmc 0:1 0x41800000 sun8i-v3s-saltedfishpi.dtb \u5982\u679c\u662f EXT4 \u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u91c7\u7528 ext2load \u6216\u8005 ext4load \u4ee3\u66ff\u4e0a\u9762\u7684 fatload \u547d\u4ee4\u3002\u73b0\u5728\u5f00\u59cb\u542f\u52a8\u5165\u5185\u6838\uff1a => setenv bootargs console=ttyS0,115200 => bootz 0x41000000 - 0x41800000 \u6b64\u65f6\u5e94\u8be5\u53ef\u4ee5\u770b\u5230 Linux \u5185\u6838\u6210\u529f\u542f\u52a8\uff0c\u4f46\u56e0\u4e3a\u627e\u4e0d\u5230 rootfs\uff0c\u6240\u4ee5\u672a\u80fd\u5b8c\u6210\u542f\u52a8\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0crootfs \u4f4d\u4e8e TF \u5361\u7684\u7b2c\u4e8c\u4e2a\u5206\u533a\uff0c\u4e8e\u662f\u53ef\u4ee5\u66f4\u6539\u542f\u52a8\u53c2\u6570\u5e76\u8fdb\u5165\u5185\u6838\uff1a => fatload mmc 0:1 0x41000000 zImage => fatload mmc 0:1 0x41800000 sun8i-v3s-saltedfishpi.dtb => setenv bootargs console=ttyS0,115200 root=/dev/mmcblk0p2 rw rootwait => bootz 0x41000000 - 0x41800000 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684 rootwait \u5fc5\u987b\u8981\u6dfb\u52a0\uff0c\u53e6\u5916 /dev/mmcblk0p2 \u4ee3\u8868\u4e86 TF \u5361\u4e0a\u7684\u7b2c\u4e8c\u4e2a\u5206\u533a\uff0c\u5728\u521a\u624d\u6ca1\u6709\u6307\u5b9a rootfs \u7684\u65f6\u5019\uff0c\u5185\u6838\u4f1a\u8f93\u51fa\u5982\u4e0b\u4fe1\u606f\uff1a [ 2.252872] Please append a correct \"root=\" boot option; here are the available partitions: [ 2.261315] b300 15273984 mmcblk0 [ 2.261320] driver: mmcblk [ 2.268156] b301 42522 mmcblk0p1 68db6199-01 [ 2.268159] [ 2.274971] b302 15226880 mmcblk0p2 68db6199-02 [ 2.274974] \u60a8\u53ef\u4ee5\u6839\u636e\u5728\u8fd9\u91cc\u663e\u793a\u51fa\u6765\u7684\u4fe1\u606f\u627e\u5230\u5e76\u628a mmcblk0p2 \u6539\u6210\u76f8\u5e94\u7684 rootfs \u3002 \u5982\u679c\u60f3\u8981\u4fdd\u5b58\u542f\u52a8\u547d\u4ee4\uff0c\u4f7f\u5f97\u4e4b\u540e\u90fd\u53ef\u4ee5\u81ea\u52a8\u542f\u52a8\uff0c\u8f93\u5165\u4ee5\u4e0b\u6307\u4ee4\uff1a => setenv bootcmd 'fatload mmc 0:1 0x41000000 zImage;fatload mmc 0:1 0x41800000 sun8i-v3s-saltedfishpi.dtb; setenv bootargs console=ttyS0,115200 root=/dev/mmcblk0p2 rw rootwait; bootz 0x41000000 - 0x41800000' => saveenv \u6b64\u540e\u6bcf\u6b21\u4e0a\u7535\u4e4b\u540e U-Boot \u5c31\u4f1a\u81ea\u52a8\u542f\u52a8\u8fdb\u5165 Linux \u4e86\u3002\u4e5f\u53ef\u4ee5\u624b\u52a8\u8f93\u5165 boot \u8fdb\u5165 Linux \u3002","title":"Linux"},{"location":"build/linux/#linux","text":"","title":"Linux \u5185\u6838\u7f16\u8bd1"},{"location":"build/linux/#linux-patch","text":"\u6211\u4eec\u5728 sbc-fish/sfpi:/linux \u7ef4\u62a4\u4e86\u5bf9 Linux \u4e3b\u7ebf\u5185\u6838\u7684 Patch \u3002\u5b83\u63d0\u4f9b\u4e86\u54b8\u9c7c\u6d3e\u8bbe\u5907\u7684 DTS\u3001\u9ed8\u8ba4\u7684 .config \u548c\u5176\u5b83\u4e00\u4e9b\u5c0f\u7684\u66f4\u6539\u3002\u76ee\u524d\u5df2\u7ecf\u652f\u6301\u7684\u5185\u6838\u7248\u672c\u89c1\u4ee5\u4e0a\u94fe\u63a5\uff0c\u5176\u5b83\u5185\u6838\u7248\u672c\u53ef\u6839\u636e\u6700\u63a5\u8fd1\u7684\u5185\u6838\u7248\u672c\u7684 Patch \u8fdb\u884c\u66f4\u6539\u3002 \u4e0b\u8f7d Linux \u5185\u6838\u6e90\u7801\uff0c\u4ee5 4.19.1 \u4e3a\u4f8b\uff1a $ wget https://cdn.kernel.org/pub/linux/kernel/v4.x/linux-4.19.1.tar.xz $ tar xvf linux-4.19.1.tar.xz $ cd linux-4.19.1 \u5e94\u7528\u6211\u4eec\u63d0\u4f9b\u7684 Patch \uff1a $ curl https://raw.githubusercontent.com/sbc-fish/sfpi/master/linux/4.19.1/sfpi-linux-4.19.1.patch | patch -p1 patching file arch/arm/boot/dts/Makefile patching file arch/arm/boot/dts/sun8i-v3s-saltedfishpi.dts patching file arch/arm/boot/dts/sun8i-v3s.dtsi patching file arch/arm/configs/saltedfishpi_defconfig patching file drivers/bluetooth/Kconfig patching file drivers/bluetooth/hci_h5.c","title":"\u4e0b\u8f7d Linux \u6e90\u7801\u548c\u5e94\u7528 Patch"},{"location":"build/linux/#_1","text":"\u60a8\u5982\u679c\u5df2\u7ecf\u9605\u8bfb\u8fc7 [\u7f16\u8bd1\u548c\u5237\u5165 U-Boot]\uff08https://sbc-fish.github.io/sfpi/uboot/\uff09\u4e2d\u7684\u76f8\u5173\u90e8\u5206\uff0c\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u5c0f\u8282\u3002 \u60a8\u5982\u679c\u662f Archlinux \u7528\u6237\uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5 arm-none-eabi-gcc \uff1a $ sudo pacman -Sy arm-none-eabi-gcc \u60a8\u5982\u679c\u662f Debian \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf \uff1a $ sudo apt install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Ubuntu \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf $ sudo apt-get install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Fedora \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 arm-none-eabi-gcc-cs $ sudo dnf install arm-none-eabi-gcc-cs \u5bf9\u4e8e\u672a\u5217\u51fa\u7684 Linux \u53d1\u578b\u7248\uff0c\u60a8\u53ef\u4ee5\u641c\u7d22\u4e00\u4e0b\u5b83\u7684\u6e90\u6709\u6ca1\u6709\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Linaro GCC \u3002 \u7531\u4e8e\u5404\u53d1\u578b\u7248\u5b89\u88c5\u7684\u4ea4\u53c9\u7f16\u8bd1\u5668\u524d\u7f00\u4e0d\u540c\uff0c\u5982\u679c\u5b89\u88c5\u7684\u7f16\u8bd1\u5668\u662f arm-none-eabi-gcc \uff0c\u90a3\u4e48\u6211\u4eec\u4e4b\u540e\u7528\u5230\u7684 CROSS_COMPILE \u5c31\u662f arm-none-eabi- \uff0c\u5373\u53bb\u6389\u6700\u540e\u7684 gcc \u90e8\u5206\u3002\u5176\u5b83\u5e38\u89c1\u7684\u8fd8\u6709 arm-linux-gnueabihf- \u548c arm-linux-gnueabi \uff0c\u90fd\u53ef\u4ee5\u3002","title":"\u83b7\u53d6\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe"},{"location":"build/linux/#linux-config","text":"","title":"\u751f\u6210\u5e76\u66f4\u6539 Linux .config"},{"location":"build/linux/#config","text":"\u5728\u521a\u624d\u5e94\u7528\u7684 Patch \u4e2d\uff0c\u5df2\u7ecf\u5305\u542b\u4e86\u4e00\u4e2a\u5df2\u7ecf\u6d4b\u8bd5\u7684 .config \uff0c\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- saltedfishpi_defconfig \u5982\u679c\u60f3\u8981\u81ea\u5df1\u8c03\u6574\u914d\u7f6e\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- menuconfig","title":"\u91c7\u7528\u6211\u4eec\u63d0\u4f9b\u7684 .config"},{"location":"build/linux/#linux_1","text":"\u7528\u5982\u4e0b\u547d\u4ee4\u7f16\u8bd1 Linux \u5185\u6838\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- -j4 \u7f16\u8bd1 Linux \u7684\u65f6\u957f\u53d6\u51b3\u4e8e\u60a8\u7684\u673a\u5668\u7684\u786c\u4ef6\u8bbe\u65bd\uff0c\u5e76\u6839\u636e CPU \u7ebf\u7a0b\u6570\u8c03\u6574 -j \u53c2\u6570\u3002\u4e0d\u59a8\u5728\u7b49\u5f85 Linux \u7f16\u8bd1\u7684\u65f6\u5019\u70b9\u676f\u5496\u5561\u3002 \u7f16\u8bd1\u597d\u540e\uff0c\u5e94\u8be5\u53ef\u4ee5\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684 arch/arm/boot/zImage \u548c arch/arm/boot/dts/sun8i-v3s-saltedfishpi.dtb \u6587\u4ef6\u3002","title":"\u7f16\u8bd1 Linux \u5185\u6838"},{"location":"build/linux/#tf","text":"\u5c06\u7f16\u8bd1\u5f97\u5230\u7684 arch/arm/boot/zImage \u548c arch/arm/boot/dts/sun8i-v3s-saltedfishpi.dtb \u6587\u4ef6\u62f7\u8d1d\u5165 TF \u5361\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002\u5efa\u8bae\u5199\u5165 FAT \u6216\u8005 EXT \u6587\u4ef6\u7cfb\u7edf\u3002","title":"\u5199\u5165 TF \u5361"},{"location":"build/linux/#rootfs","text":"\u4ec5\u6709\u5185\u6838\u5e76\u4e0d\u591f\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e00\u4e2a rootfs \u3002\u5e38\u89c1\u7684\u529e\u6cd5\u6709 buildroot \u548c\u76f4\u63a5\u91c7\u7528\u5df2\u6709\u7684\u53d1\u578b\u7248\u7684\u955c\u50cf\uff0c\u8fd9\u91cc\u4ee5 ArchLinuxARM \u4e3a\u4f8b\uff0c\u5047\u8bbe\u6211\u4eec\u9884\u671f\u7684 rootfs \u5206\u533a\u5df2\u7ecf\u6302\u8f7d\u5230\u4e86 mnt \u5904\uff1a $ wget http://os.archlinuxarm.org/os/ArchLinuxARM-armv7-latest.tar.gz $ bsdtar -xpf ArchLinuxARM-armv7-latest.tar.gz -C mnt \u60a8\u5982\u679c\u91c7\u7528\u7684\u662f macOS \u7cfb\u7edf\u5e76\u4e14\u65e0\u6cd5\u5199\u5165 EXT4 \u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u5148\u627e\u5230\u4e00\u53f0 Linux \u673a\u5668\uff0c\u8fdb\u884c\u5982\u4e0b\u64cd\u4f5c\uff1a $ dd if=/dev/zero of=archlinuxarm.img bs=1M count=1024 $ mkfs.ext4 archlinuxarm.img $ sudo mount -o loop archlinuxarm.img mnt $ wget http://os.archlinuxarm.org/os/ArchLinuxARM-armv7-latest.tar.gz $ bsdtar -xpf ArchLinuxARM-armv7-latest.tar.gz -C mnt $ sudo umount mnt \u5c06\u5f97\u5230\u7684 archlinuxarm.img \u590d\u5236\u5230 macOS \u7cfb\u7edf\u4e0b\uff0c\u518d\u5199\u5165\uff1a $ sudo dd if=archlinuxarm.img of=/dev/[disk] bs=65535 \u6b64\u5904\u7684 [disk] \u53ef\u4ee5\u7528 diskutil list \u627e\u5230\u76f8\u5e94\u7684\u5206\u533a\u3002\u4e3a\u4e86\u6027\u80fd\u66f4\u597d\uff0c\u53ef\u4ee5\u5728\u8bbe\u5907\u540d\u79f0\u524d\u6dfb\u52a0\u4e00\u4e2a r \uff0c\u5982 /dev/rdisk4s2 \u3002 \u5982\u679c\u60a8\u5728 macOS \u4e0a\u5b89\u88c5\u4e86 e2fsprogs \uff08 brew install e2fsprogs \uff09\uff0c\u53ef\u4ee5\u628a\u6587\u4ef6\u7cfb\u7edf\u6269\u5927\u6210\u5206\u533a\u7684\u5b8c\u6574\u5927\u5c0f\uff1a $ sudo /usr/local/opt/e2fsprogs/sbin/resize2fs -p /dev/[disk] \u8fd9\u91cc\u7684 [disk] \u610f\u4e49\u540c\u4e0a\u3002","title":"\u51c6\u5907 rootfs"},{"location":"build/linux/#u-boot","text":"\u5728 \u7f16\u8bd1\u548c\u5237\u5165 U-Boot \u4e2d\uff0c\u60a8\u5e94\u8be5\u5df2\u7ecf\u53ef\u4ee5\u8fdb\u5165\u5230 U-Boot \u7684\u754c\u9762\u4e86\u3002\u9996\u5148\u9700\u8981\u627e\u5230\u6211\u4eec\u521a\u624d\u6784\u5efa\u5f97\u5230\u7684\u5185\u6838\u548c .dtb \u6587\u4ef6\u3002\u67e5\u770b TF \u5361\u7684\u5206\u533a\u8868\uff1a => part list mmc 0 Partition Map for MMC device 0 -- Partition Type: DOS Part Start Sector Num Sectors UUID Type 1 8192 85045 68db6199-01 0c 2 94208 30453760 68db6199-02 83 => \u6b64\u5904\u53ef\u4ee5\u770b\u5230 TF \u5361\u4e0a\u7684\u5206\u533a\u60c5\u51b5\u3002\u8fd9\u91cc\u7684\u4f8b\u5b50\u662f\uff0c\u4e00\u4e2a FAT \u5206\u533a\u4fdd\u5b58\u5185\u6838\u548c .dtb \u6587\u4ef6\uff0c\u53e6\u4e00\u4e2a EXT4 \u5206\u533a\u5b58\u653e\u7740 rootfs \u3002\u8f93\u5165\u4ee5\u4e0b\u547d\u4ee4\u53ef\u4ee5\u786e\u8ba4\u4e00\u4e0b\u5185\u6838\u5b58\u653e\u7684\u5730\u65b9\uff1a => fatls mmc 0:1 # \u6d4f\u89c8\u5206\u533a 1 \uff08FAT \u6587\u4ef6\u7cfb\u7edf\uff09\u4e0a\u7684\u6587\u4ef6 => ext4ls mmc 0:2 # \u6d4f\u89c8\u5206\u533a 2 \uff08EXT4 \u6587\u4ef6\u7cfb\u7edf\uff09\u4e0a\u7684\u6587\u4ef6 \u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6240\u9700\u7684\u6587\u4ef6 zImage \u548c sun8i-v3s-saltedfishpi.dtb \u653e\u5728\u4e86\u7b2c\u4e00\u4e2a\u5206\u533a\uff08FAT \u6587\u4ef6\u7cfb\u7edf\uff09\u4e2d\u3002\u8f93\u5165\u5982\u4e0b\u547d\u4ee4\u628a\u5185\u6838\u548c .dtb \u6587\u4ef6\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff1a => fatload mmc 0:1 0x41000000 zImage => fatload mmc 0:1 0x41800000 sun8i-v3s-saltedfishpi.dtb \u5982\u679c\u662f EXT4 \u6587\u4ef6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u91c7\u7528 ext2load \u6216\u8005 ext4load \u4ee3\u66ff\u4e0a\u9762\u7684 fatload \u547d\u4ee4\u3002\u73b0\u5728\u5f00\u59cb\u542f\u52a8\u5165\u5185\u6838\uff1a => setenv bootargs console=ttyS0,115200 => bootz 0x41000000 - 0x41800000 \u6b64\u65f6\u5e94\u8be5\u53ef\u4ee5\u770b\u5230 Linux \u5185\u6838\u6210\u529f\u542f\u52a8\uff0c\u4f46\u56e0\u4e3a\u627e\u4e0d\u5230 rootfs\uff0c\u6240\u4ee5\u672a\u80fd\u5b8c\u6210\u542f\u52a8\u3002\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0crootfs \u4f4d\u4e8e TF \u5361\u7684\u7b2c\u4e8c\u4e2a\u5206\u533a\uff0c\u4e8e\u662f\u53ef\u4ee5\u66f4\u6539\u542f\u52a8\u53c2\u6570\u5e76\u8fdb\u5165\u5185\u6838\uff1a => fatload mmc 0:1 0x41000000 zImage => fatload mmc 0:1 0x41800000 sun8i-v3s-saltedfishpi.dtb => setenv bootargs console=ttyS0,115200 root=/dev/mmcblk0p2 rw rootwait => bootz 0x41000000 - 0x41800000 \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u7684 rootwait \u5fc5\u987b\u8981\u6dfb\u52a0\uff0c\u53e6\u5916 /dev/mmcblk0p2 \u4ee3\u8868\u4e86 TF \u5361\u4e0a\u7684\u7b2c\u4e8c\u4e2a\u5206\u533a\uff0c\u5728\u521a\u624d\u6ca1\u6709\u6307\u5b9a rootfs \u7684\u65f6\u5019\uff0c\u5185\u6838\u4f1a\u8f93\u51fa\u5982\u4e0b\u4fe1\u606f\uff1a [ 2.252872] Please append a correct \"root=\" boot option; here are the available partitions: [ 2.261315] b300 15273984 mmcblk0 [ 2.261320] driver: mmcblk [ 2.268156] b301 42522 mmcblk0p1 68db6199-01 [ 2.268159] [ 2.274971] b302 15226880 mmcblk0p2 68db6199-02 [ 2.274974] \u60a8\u53ef\u4ee5\u6839\u636e\u5728\u8fd9\u91cc\u663e\u793a\u51fa\u6765\u7684\u4fe1\u606f\u627e\u5230\u5e76\u628a mmcblk0p2 \u6539\u6210\u76f8\u5e94\u7684 rootfs \u3002 \u5982\u679c\u60f3\u8981\u4fdd\u5b58\u542f\u52a8\u547d\u4ee4\uff0c\u4f7f\u5f97\u4e4b\u540e\u90fd\u53ef\u4ee5\u81ea\u52a8\u542f\u52a8\uff0c\u8f93\u5165\u4ee5\u4e0b\u6307\u4ee4\uff1a => setenv bootcmd 'fatload mmc 0:1 0x41000000 zImage;fatload mmc 0:1 0x41800000 sun8i-v3s-saltedfishpi.dtb; setenv bootargs console=ttyS0,115200 root=/dev/mmcblk0p2 rw rootwait; bootz 0x41000000 - 0x41800000' => saveenv \u6b64\u540e\u6bcf\u6b21\u4e0a\u7535\u4e4b\u540e U-Boot \u5c31\u4f1a\u81ea\u52a8\u542f\u52a8\u8fdb\u5165 Linux \u4e86\u3002\u4e5f\u53ef\u4ee5\u624b\u52a8\u8f93\u5165 boot \u8fdb\u5165 Linux \u3002","title":"\u914d\u7f6e U-Boot \u542f\u52a8\u9009\u9879"},{"location":"build/uboot/","text":"\u7f16\u8bd1\u548c\u5237\u5165 U-Boot \u4ece\u6e90\u4ee3\u7801\u7f16\u8bd1 U-Boot \u83b7\u53d6 U-Boot \u5728\u7f51\u4e0a\u83b7\u53d6 U-Boot \u7684\u6e90\u4ee3\u7801\u3002\u4ee5 Github \u4e3a\u4f8b\uff0c\u628a u-boot/u-boot \u4ed3\u5e93\u514b\u9686\u4e0b\u6765\uff1a $ git clone git@github.com:u-boot/u-boot.git \u5982\u679c\u60f3\u8981\u4e00\u4e2a\u7a33\u5b9a\u7248\u672c\u7684 U-Boot \uff0c\u4f60\u53ef\u4ee5 checkout \u4e00\u4e2a tag\uff0c\u4ee5 v2018.11-rc3 \u4e3a\u4f8b\uff1a $ git checkout v2018.11-rc3 \u6216\u8005\u76f4\u63a5\u4e0b\u8f7d\u6307\u5b9a\u7248\u672c\u7684 U-Boot \u6e90\u7801\uff0c\u4ee5 v2018.11-rc3 \u4e3a\u4f8b\uff1a $ wget https://github.com/u-boot/u-boot/archive/v2018.11-rc3.tar.gz $ tar xvf v2018.11-rc3.tar.gz \u83b7\u53d6\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe \u60a8\u5982\u679c\u662f Archlinux \u7528\u6237\uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5 arm-none-eabi-gcc \uff1a $ sudo pacman -Sy arm-none-eabi-gcc \u60a8\u5982\u679c\u662f Debian \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf \uff1a $ sudo apt install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Ubuntu \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf $ sudo apt-get install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Fedora \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 arm-none-eabi-gcc-cs $ sudo dnf install arm-none-eabi-gcc-cs \u5bf9\u4e8e\u672a\u5217\u51fa\u7684 Linux \u53d1\u578b\u7248\uff0c\u60a8\u53ef\u4ee5\u641c\u7d22\u4e00\u4e0b\u5b83\u7684\u6e90\u6709\u6ca1\u6709\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Linaro GCC \u3002 \u7531\u4e8e\u5404\u53d1\u578b\u7248\u5b89\u88c5\u7684\u4ea4\u53c9\u7f16\u8bd1\u5668\u524d\u7f00\u4e0d\u540c\uff0c\u5982\u679c\u5b89\u88c5\u7684\u7f16\u8bd1\u5668\u662f arm-none-eabi-gcc \uff0c\u90a3\u4e48\u6211\u4eec\u4e4b\u540e\u7528\u5230\u7684 CROSS_COMPILE \u5c31\u662f arm-none-eabi- \uff0c\u5373\u53bb\u6389\u6700\u540e\u7684 gcc \u90e8\u5206\u3002\u5176\u5b83\u5e38\u89c1\u7684\u8fd8\u6709 arm-linux-gnueabihf- \u548c arm-linux-gnueabi \uff0c\u90fd\u53ef\u4ee5\u3002 \u914d\u7f6e U-Boot \u91c7\u7528\u6211\u4eec\u63d0\u4f9b\u7684 .config \u6211\u4eec\u63d0\u4f9b\u7684\u5df2\u7ecf\u6d4b\u8bd5\u8fc7\u7684 U-Boot \u7684 .config \u6587\u4ef6\u5df2\u7ecf\u5b58\u653e\u5728 sbc-fish/sfpi \u7684 u-boot \u76ee\u5f55\u4e0b\u3002\u8fd9\u91cc\u7684 .config \u90fd\u662f\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u5230 U-Boot \u6839\u76ee\u5f55\u4e2d\u4f7f\u7528\u7684\u3002 \u4ee5 U-Boot v2018.11-rc3 \u4e3a\u4f8b\uff0c\u8fdb\u5165\u5230 U-Boot \u76ee\u5f55\uff0c\u4e0b\u8f7d .config \uff1a $ wget https://raw.githubusercontent.com/sbc-fish/sfpi/master/u-boot/v2018.11-rc3/.config \u5982\u679c\u6211\u4eec\u6ca1\u6709\u63d0\u4f9b\u76f8\u5e94\u7248\u672c\u7684 .config \uff0c\u53ef\u4ee5\u627e\u4e00\u4e2a\u7248\u672c\u8f83\u8fd1\u7684 .config \u4e0b\u8f7d\u4e0b\u6765\u7528\uff0c\u5982\u679c\u6709\u90e8\u5206\u914d\u7f6e\u9700\u8981\u66f4\u6539\uff0c\u5728\u540e\u7eed\u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u6709\u76f8\u5e94\u7684\u63d0\u793a\uff0c\u4e00\u822c\u7528\u9ed8\u8ba4\u53c2\u6570\u5c31\u53ef\u4ee5\u4e86\u3002 \u5982\u679c\u60f3\u8981\u81ea\u5df1\u8c03\u6574\u914d\u7f6e\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- menuconfig \u5176\u4e2d CROSS_COMPILE \u662f\u60a8\u6240\u5b89\u88c5\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u7684\u524d\u7f00\u3002\u5982\u679c\u60a8\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u7684 .config \uff0c\u5e94\u8be5\u4e0d\u9700\u8981\u505a\u66f4\u6539\u3002 \u7f16\u8bd1 U-Boot \u7136\u540e\u5f00\u59cb\u7f16\u8bd1\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- -j24 \u5176\u4e2d -j24 \u6839\u636e\u60a8\u7684\u673a\u5668\u7684 CPU \u8fdb\u884c\u8c03\u6574\u3002\u6b64\u65f6\u5e94\u8be5\u5f97\u5230\u4e00\u4e2a u-boot-sunxi-with-spl.bin \u7684\u6587\u4ef6\uff0c\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u3002 \u5237\u5165 U-Boot \u5206\u533a \u5efa\u8bae\u5411 TF \u5361\u5199\u5165 MBR \u683c\u5f0f\u7684\u5206\u533a\u8868\uff0c\u5e76\u5728\u7b2c\u4e00\u4e2a\u5206\u533a\u524d\u9884\u7559\u4e00\u5b9a\u7684\u7a7a\u95f4\u3002\u5982\u679c\u6211\u4eec\u5728\u4e0a\u4e00\u6b65\u7f16\u8bd1\u7684\u6587\u4ef6\u5927\u5c0f\u4e3a\u51e0\u767e K \uff0c\u4e00\u4e2a\u53ef\u4f9b\u53c2\u8003\u7684\u5206\u533a\u65b9\u6848\u662f\uff1a Disk: /dev/disk4 geometry: 980/128/63 [7907328 sectors] Offset: 0 Signature: 0xAA55 Starting Ending #: id cyl hd sec - cyl hd sec [ start - size] ------------------------------------------------------------------------ 1: 0B 1023 254 63 - 1023 254 63 [ 2048 - 20480] Win95 FAT-32 2: 83 1023 254 63 - 1023 254 63 [ 22528 - 7884800] Linux files* 3: 00 0 0 0 - 0 0 0 [ 0 - 0] unused 4: 00 0 0 0 - 0 0 0 [ 0 - 0] unused \u7b2c\u4e00\u4e2a\u5206\u533a\uff08FAT-32\uff09\u4ece\u7b2c 2048 \u4e2a\u6247\u533a\u5f00\u59cb\uff0c\u5373\u5728 1M \uff082048*512=1M\uff09 \u7684\u5730\u65b9\u5f00\u59cb\uff0c\u8fd9\u6837\u7ed9 U-Boot \u9884\u7559\u51fa\u8db3\u591f\u7684\u7a7a\u95f4\u3002\u8fd9\u4e2a\u9884\u7559\u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u6839\u636e\u7f16\u8bd1\u51fa\u6765\u7684 u-boot-sunxi-with-spl.bin \u6587\u4ef6\u548c TF \u5361\u5bb9\u91cf\u81ea\u884c\u8c03\u6574\u3002\u5bf9\u4e8e\u5206\u533a\u5de5\u5177\u7684\u4f7f\u7528\uff0c\u53ef\u4ee5\u53c2\u8003 Partitioning - Archlinux Wiki \u3001 fdisk - Archlinux Wiki \u6216 fdisk Manpages \u3002 \u4f7f\u7528 DD \u5237\u5165 U-Boot \u628a u-boot-sunxi-with-spl.bin \u5199\u5165\u5230 TF \u5361\u7684 8192 \u504f\u79fb\u5904\u5373\u53ef\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a $ sudo dd if=u-boot-sunxi-with-spl.bin of=/dev/disk4 bs=1024 seek=8 \u5982\u679c\u60a8\u662f macOS \u7528\u6237\uff0c\u53ef\u4ee5\u4f7f\u7528\u6211\u4eec\u7f16\u5199\u7684 flash_uboot_macOS.sh \u3002 \u542f\u52a8 \u8fde\u63a5\u4e32\u53e3 \u628a TF \u5361\u63d2\u5165\u5230\u54b8\u9c7c\u6d3e\u4e2d\uff0c\u8fde\u63a5 microUSB \u5230\u7535\u8111\u4e2d\uff0c\u5e94\u8be5\u4f1a\u770b\u5230\u4e00\u4e2a USB to Serial \u8bbe\u5907\u3002\u5404\u5e73\u53f0\u7684\u9a71\u52a8\u53ef\u4ee5\u5728 \u6c81\u6052\u5b98\u7f51\u4e0b\u8f7d \u5f97\u5230\u3002\u5728 Windows \u4e0b\uff0c\u53ef\u4ee5\u91c7\u7528\u4e32\u53e3\u52a9\u624b\u7b49\u5de5\u5177\uff0c\u5728 Linux \u548c macOS \u4e0b\uff0c\u53ef\u4ee5\u7528\u5982\u4e0b\u547d\u4ee4\uff1a $ screen [tty] 115200 \u67e5\u770b\u4e32\u53e3\u3002\u5bf9\u4e8e macOS \uff0c\u6b64\u5904\u7684 tty \u5e94\u4e3a /dev/tty.wchusbserial* \u7684\u683c\u5f0f\u3002 \u6309\u4e0b\u677f\u4e0a\u7684\u4e0a\u7535\u6309\u94ae\uff0c\u5982\u679c\u914d\u7f6e\u6210\u529f\uff0c\u5e94\u8be5\u53ef\u4ee5\u6210\u529f\u770b\u5230 U-Boot \u7684\u542f\u52a8\u5982\u4e0b\uff1a U-Boot SPL 2018.11-rc3 (Nov 09 2018 - 11:55:32 +0800) DRAM: 64 MiB Trying to boot from MMC1 U-Boot 2018.11-rc3 (Nov 09 2018 - 11:55:32 +0800) Allwinner Technology CPU: Allwinner V3s (SUN8I 1681) Model: Lichee Pi Zero DRAM: 64 MiB MMC: SUNXI SD/MMC: 0 Loading Environment from FAT... OK In: serial@01c28000 Out: serial@01c28000 Err: serial@01c28000 Net: No ethernet found. starting USB... No controllers found Hit any key to stop autoboot: 0 => \u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684 Linux \u5185\u6838\u7f16\u8bd1\u8fc7\u7a0b\u4e86\u3002\u89c1 Linux \u5185\u6838\u7684\u7f16\u8bd1 \u3002","title":"U-Boot"},{"location":"build/uboot/#u-boot","text":"","title":"\u7f16\u8bd1\u548c\u5237\u5165 U-Boot"},{"location":"build/uboot/#u-boot_1","text":"","title":"\u4ece\u6e90\u4ee3\u7801\u7f16\u8bd1 U-Boot"},{"location":"build/uboot/#u-boot_2","text":"\u5728\u7f51\u4e0a\u83b7\u53d6 U-Boot \u7684\u6e90\u4ee3\u7801\u3002\u4ee5 Github \u4e3a\u4f8b\uff0c\u628a u-boot/u-boot \u4ed3\u5e93\u514b\u9686\u4e0b\u6765\uff1a $ git clone git@github.com:u-boot/u-boot.git \u5982\u679c\u60f3\u8981\u4e00\u4e2a\u7a33\u5b9a\u7248\u672c\u7684 U-Boot \uff0c\u4f60\u53ef\u4ee5 checkout \u4e00\u4e2a tag\uff0c\u4ee5 v2018.11-rc3 \u4e3a\u4f8b\uff1a $ git checkout v2018.11-rc3 \u6216\u8005\u76f4\u63a5\u4e0b\u8f7d\u6307\u5b9a\u7248\u672c\u7684 U-Boot \u6e90\u7801\uff0c\u4ee5 v2018.11-rc3 \u4e3a\u4f8b\uff1a $ wget https://github.com/u-boot/u-boot/archive/v2018.11-rc3.tar.gz $ tar xvf v2018.11-rc3.tar.gz","title":"\u83b7\u53d6 U-Boot"},{"location":"build/uboot/#_1","text":"\u60a8\u5982\u679c\u662f Archlinux \u7528\u6237\uff0c\u53ef\u4ee5\u76f4\u63a5\u5b89\u88c5 arm-none-eabi-gcc \uff1a $ sudo pacman -Sy arm-none-eabi-gcc \u60a8\u5982\u679c\u662f Debian \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf \uff1a $ sudo apt install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Ubuntu \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 gcc-arm-linux-gnueabihf $ sudo apt-get install gcc-arm-linux-gnueabihf \u60a8\u5982\u679c\u662f Fedora \u7528\u6237\uff0c\u53ef\u4ee5\u5b89\u88c5 arm-none-eabi-gcc-cs $ sudo dnf install arm-none-eabi-gcc-cs \u5bf9\u4e8e\u672a\u5217\u51fa\u7684 Linux \u53d1\u578b\u7248\uff0c\u60a8\u53ef\u4ee5\u641c\u7d22\u4e00\u4e0b\u5b83\u7684\u6e90\u6709\u6ca1\u6709\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528 Linaro GCC \u3002 \u7531\u4e8e\u5404\u53d1\u578b\u7248\u5b89\u88c5\u7684\u4ea4\u53c9\u7f16\u8bd1\u5668\u524d\u7f00\u4e0d\u540c\uff0c\u5982\u679c\u5b89\u88c5\u7684\u7f16\u8bd1\u5668\u662f arm-none-eabi-gcc \uff0c\u90a3\u4e48\u6211\u4eec\u4e4b\u540e\u7528\u5230\u7684 CROSS_COMPILE \u5c31\u662f arm-none-eabi- \uff0c\u5373\u53bb\u6389\u6700\u540e\u7684 gcc \u90e8\u5206\u3002\u5176\u5b83\u5e38\u89c1\u7684\u8fd8\u6709 arm-linux-gnueabihf- \u548c arm-linux-gnueabi \uff0c\u90fd\u53ef\u4ee5\u3002","title":"\u83b7\u53d6\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe"},{"location":"build/uboot/#u-boot_3","text":"","title":"\u914d\u7f6e U-Boot"},{"location":"build/uboot/#config","text":"\u6211\u4eec\u63d0\u4f9b\u7684\u5df2\u7ecf\u6d4b\u8bd5\u8fc7\u7684 U-Boot \u7684 .config \u6587\u4ef6\u5df2\u7ecf\u5b58\u653e\u5728 sbc-fish/sfpi \u7684 u-boot \u76ee\u5f55\u4e0b\u3002\u8fd9\u91cc\u7684 .config \u90fd\u662f\u53ef\u4ee5\u76f4\u63a5\u590d\u5236\u5230 U-Boot \u6839\u76ee\u5f55\u4e2d\u4f7f\u7528\u7684\u3002 \u4ee5 U-Boot v2018.11-rc3 \u4e3a\u4f8b\uff0c\u8fdb\u5165\u5230 U-Boot \u76ee\u5f55\uff0c\u4e0b\u8f7d .config \uff1a $ wget https://raw.githubusercontent.com/sbc-fish/sfpi/master/u-boot/v2018.11-rc3/.config \u5982\u679c\u6211\u4eec\u6ca1\u6709\u63d0\u4f9b\u76f8\u5e94\u7248\u672c\u7684 .config \uff0c\u53ef\u4ee5\u627e\u4e00\u4e2a\u7248\u672c\u8f83\u8fd1\u7684 .config \u4e0b\u8f7d\u4e0b\u6765\u7528\uff0c\u5982\u679c\u6709\u90e8\u5206\u914d\u7f6e\u9700\u8981\u66f4\u6539\uff0c\u5728\u540e\u7eed\u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u6709\u76f8\u5e94\u7684\u63d0\u793a\uff0c\u4e00\u822c\u7528\u9ed8\u8ba4\u53c2\u6570\u5c31\u53ef\u4ee5\u4e86\u3002 \u5982\u679c\u60f3\u8981\u81ea\u5df1\u8c03\u6574\u914d\u7f6e\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- menuconfig \u5176\u4e2d CROSS_COMPILE \u662f\u60a8\u6240\u5b89\u88c5\u7684\u4ea4\u53c9\u7f16\u8bd1\u5de5\u5177\u94fe\u7684\u524d\u7f00\u3002\u5982\u679c\u60a8\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u7684 .config \uff0c\u5e94\u8be5\u4e0d\u9700\u8981\u505a\u66f4\u6539\u3002","title":"\u91c7\u7528\u6211\u4eec\u63d0\u4f9b\u7684 .config"},{"location":"build/uboot/#u-boot_4","text":"\u7136\u540e\u5f00\u59cb\u7f16\u8bd1\uff1a $ make ARCH=arm CROSS_COMPILE=arm-none-eabi- -j24 \u5176\u4e2d -j24 \u6839\u636e\u60a8\u7684\u673a\u5668\u7684 CPU \u8fdb\u884c\u8c03\u6574\u3002\u6b64\u65f6\u5e94\u8be5\u5f97\u5230\u4e00\u4e2a u-boot-sunxi-with-spl.bin \u7684\u6587\u4ef6\uff0c\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u3002","title":"\u7f16\u8bd1 U-Boot"},{"location":"build/uboot/#u-boot_5","text":"","title":"\u5237\u5165 U-Boot"},{"location":"build/uboot/#_2","text":"\u5efa\u8bae\u5411 TF \u5361\u5199\u5165 MBR \u683c\u5f0f\u7684\u5206\u533a\u8868\uff0c\u5e76\u5728\u7b2c\u4e00\u4e2a\u5206\u533a\u524d\u9884\u7559\u4e00\u5b9a\u7684\u7a7a\u95f4\u3002\u5982\u679c\u6211\u4eec\u5728\u4e0a\u4e00\u6b65\u7f16\u8bd1\u7684\u6587\u4ef6\u5927\u5c0f\u4e3a\u51e0\u767e K \uff0c\u4e00\u4e2a\u53ef\u4f9b\u53c2\u8003\u7684\u5206\u533a\u65b9\u6848\u662f\uff1a Disk: /dev/disk4 geometry: 980/128/63 [7907328 sectors] Offset: 0 Signature: 0xAA55 Starting Ending #: id cyl hd sec - cyl hd sec [ start - size] ------------------------------------------------------------------------ 1: 0B 1023 254 63 - 1023 254 63 [ 2048 - 20480] Win95 FAT-32 2: 83 1023 254 63 - 1023 254 63 [ 22528 - 7884800] Linux files* 3: 00 0 0 0 - 0 0 0 [ 0 - 0] unused 4: 00 0 0 0 - 0 0 0 [ 0 - 0] unused \u7b2c\u4e00\u4e2a\u5206\u533a\uff08FAT-32\uff09\u4ece\u7b2c 2048 \u4e2a\u6247\u533a\u5f00\u59cb\uff0c\u5373\u5728 1M \uff082048*512=1M\uff09 \u7684\u5730\u65b9\u5f00\u59cb\uff0c\u8fd9\u6837\u7ed9 U-Boot \u9884\u7559\u51fa\u8db3\u591f\u7684\u7a7a\u95f4\u3002\u8fd9\u4e2a\u9884\u7559\u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u6839\u636e\u7f16\u8bd1\u51fa\u6765\u7684 u-boot-sunxi-with-spl.bin \u6587\u4ef6\u548c TF \u5361\u5bb9\u91cf\u81ea\u884c\u8c03\u6574\u3002\u5bf9\u4e8e\u5206\u533a\u5de5\u5177\u7684\u4f7f\u7528\uff0c\u53ef\u4ee5\u53c2\u8003 Partitioning - Archlinux Wiki \u3001 fdisk - Archlinux Wiki \u6216 fdisk Manpages \u3002","title":"\u5206\u533a"},{"location":"build/uboot/#dd-u-boot","text":"\u628a u-boot-sunxi-with-spl.bin \u5199\u5165\u5230 TF \u5361\u7684 8192 \u504f\u79fb\u5904\u5373\u53ef\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a $ sudo dd if=u-boot-sunxi-with-spl.bin of=/dev/disk4 bs=1024 seek=8 \u5982\u679c\u60a8\u662f macOS \u7528\u6237\uff0c\u53ef\u4ee5\u4f7f\u7528\u6211\u4eec\u7f16\u5199\u7684 flash_uboot_macOS.sh \u3002","title":"\u4f7f\u7528 DD \u5237\u5165 U-Boot"},{"location":"build/uboot/#_3","text":"","title":"\u542f\u52a8"},{"location":"build/uboot/#_4","text":"\u628a TF \u5361\u63d2\u5165\u5230\u54b8\u9c7c\u6d3e\u4e2d\uff0c\u8fde\u63a5 microUSB \u5230\u7535\u8111\u4e2d\uff0c\u5e94\u8be5\u4f1a\u770b\u5230\u4e00\u4e2a USB to Serial \u8bbe\u5907\u3002\u5404\u5e73\u53f0\u7684\u9a71\u52a8\u53ef\u4ee5\u5728 \u6c81\u6052\u5b98\u7f51\u4e0b\u8f7d \u5f97\u5230\u3002\u5728 Windows \u4e0b\uff0c\u53ef\u4ee5\u91c7\u7528\u4e32\u53e3\u52a9\u624b\u7b49\u5de5\u5177\uff0c\u5728 Linux \u548c macOS \u4e0b\uff0c\u53ef\u4ee5\u7528\u5982\u4e0b\u547d\u4ee4\uff1a $ screen [tty] 115200 \u67e5\u770b\u4e32\u53e3\u3002\u5bf9\u4e8e macOS \uff0c\u6b64\u5904\u7684 tty \u5e94\u4e3a /dev/tty.wchusbserial* \u7684\u683c\u5f0f\u3002 \u6309\u4e0b\u677f\u4e0a\u7684\u4e0a\u7535\u6309\u94ae\uff0c\u5982\u679c\u914d\u7f6e\u6210\u529f\uff0c\u5e94\u8be5\u53ef\u4ee5\u6210\u529f\u770b\u5230 U-Boot \u7684\u542f\u52a8\u5982\u4e0b\uff1a U-Boot SPL 2018.11-rc3 (Nov 09 2018 - 11:55:32 +0800) DRAM: 64 MiB Trying to boot from MMC1 U-Boot 2018.11-rc3 (Nov 09 2018 - 11:55:32 +0800) Allwinner Technology CPU: Allwinner V3s (SUN8I 1681) Model: Lichee Pi Zero DRAM: 64 MiB MMC: SUNXI SD/MMC: 0 Loading Environment from FAT... OK In: serial@01c28000 Out: serial@01c28000 Err: serial@01c28000 Net: No ethernet found. starting USB... No controllers found Hit any key to stop autoboot: 0 => \u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e0b\u4e00\u6b65\u7684 Linux \u5185\u6838\u7f16\u8bd1\u8fc7\u7a0b\u4e86\u3002\u89c1 Linux \u5185\u6838\u7684\u7f16\u8bd1 \u3002","title":"\u8fde\u63a5\u4e32\u53e3"}]}